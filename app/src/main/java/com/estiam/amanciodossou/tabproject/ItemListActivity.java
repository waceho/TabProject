package com.estiam.amanciodossou.tabproject;import android.app.LoaderManager;import android.content.ContentValues;import android.content.Context;import android.content.DialogInterface;import android.content.Intent;import android.content.Loader;import android.database.Cursor;import android.database.sqlite.SQLiteDatabase;import android.database.sqlite.SQLiteException;import android.graphics.Color;import android.graphics.Paint;import android.os.Bundle;import android.support.annotation.NonNull;import android.support.v7.app.AlertDialog;import android.support.v7.app.AppCompatActivity;import android.support.v7.widget.GridLayoutManager;import android.support.v7.widget.LinearLayoutManager;import android.support.v7.widget.RecyclerView;import android.support.v7.widget.Toolbar;import android.support.design.widget.Snackbar;import android.util.Log;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.EditText;import android.widget.TextView;import com.estiam.amanciodossou.tabproject.dummy.DocumentInfo;import com.estiam.amanciodossou.tabproject.dummy.DocumentRecyclerAdapter;import com.estiam.amanciodossou.tabproject.dummy.DataManager;import com.estiam.amanciodossou.tabproject.dummy.DatabaseContract;import com.estiam.amanciodossou.tabproject.dummy.OpenHelper;import com.getbase.floatingactionbutton.FloatingActionButton;import com.getbase.floatingactionbutton.FloatingActionsMenu;import org.json.JSONException;import java.util.List;import static com.estiam.amanciodossou.tabproject.NoteActivity.LOADER_documentS;/** * An activity representing a list of Items. This activity * has different presentations for handset and tablet-size devices. On * handsets, the activity presents a list of items, which when touched, * lead to a {@link ItemDetailActivity} representing * item details. On tablets, the activity presents the list of items and * item details side-by-side using two vertical panes. */public class ItemListActivity extends AppCompatActivity implements LoaderManager.LoaderCallbacks<Cursor>{    /**     * Whether or not the activity is in two-pane mode, i.e. running on a tablet     * device.     */    private boolean mTwoPane;    DrawerView dv ;    private Paint mPaint;    private GridLayoutManager mdocumentsLayoutManager;    private OpenHelper mDbOpenHelper;    private RecyclerView mRecyclerItems;    private LinearLayoutManager mNotesLayoutManager;    private DocumentRecyclerAdapter mDocumentRecyclerAdapter;    private View recyclerView;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_item_list);        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);        setSupportActionBar(toolbar);        toolbar.setTitle(getTitle());        final FloatingActionButton newDoc = findViewById(R.id.newDoc);        final FloatingActionsMenu fabMenu = findViewById(R.id.multiple_actions_right);        newDoc.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                try {                    newDocumentLayout();                } catch (JSONException e) {                    e.printStackTrace();                }            fabMenu.toggle();            }        });        FloatingActionButton saveDoc = findViewById(R.id.savefab);        saveDoc.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                try {                    newDocumentLayout();                } catch (JSONException e) {                    e.printStackTrace();                }            }        });                if (findViewById(R.id.item_detail_container) != null) {            // The detail container view will be present only in the            // large-screen layouts (res/values-w900dp).            // If this view is present, then the            // activity should be in two-pane mode.            mTwoPane = true;        }        mDbOpenHelper = new OpenHelper(this);        getLoaderManager().initLoader(LOADER_documentS, null, this);        recyclerView = findViewById(R.id.item_list);        assert recyclerView != null;        setupRecyclerView((RecyclerView) recyclerView);    }    private void setupRecyclerView(@NonNull RecyclerView recyclerView) {        if (mTwoPane){            initializeSimpleDisplayContent(recyclerView);        }        else {            initializeDisplayContent(recyclerView);        }    }    private void drawer(){        dv = new DrawerView(this, null);        setContentView(dv);        mPaint = new Paint();        mPaint.setAntiAlias(true);        mPaint.setDither(true);        mPaint.setColor(Color.GREEN);        mPaint.setStyle(Paint.Style.STROKE);        mPaint.setStrokeJoin(Paint.Join.ROUND);        mPaint.setStrokeCap(Paint.Cap.ROUND);        mPaint.setStrokeWidth(12);    }    @Override    public Loader<Cursor> onCreateLoader(int id, Bundle args) {        return null;    }    @Override    public void onLoadFinished(Loader<Cursor> loader, Cursor data) {    }    @Override    public void onLoaderReset(Loader<Cursor> loader) {    }    public static class SimpleItemRecyclerViewAdapter            extends RecyclerView.Adapter<SimpleItemRecyclerViewAdapter.ViewHolder> {        private final ItemListActivity mParentActivity;        private final List<DocumentInfo> mValues;        private final boolean mTwoPane;        private final View.OnClickListener mOnClickListener = new View.OnClickListener() {            @Override            public void onClick(View view) {                DocumentInfo item = (DocumentInfo) view.getTag();                if (mTwoPane) {                    Bundle arguments = new Bundle();                    arguments.putString(ItemDetailFragment.ARG_ITEM_ID, item.getTitle());                    ItemDetailFragment fragment = new ItemDetailFragment();                    fragment.setArguments(arguments);                    mParentActivity.getSupportFragmentManager().beginTransaction()                            .replace(R.id.item_detail_container, fragment)                            .commit();                } else {                    Context context = view.getContext();                    Intent intent = new Intent(context, ItemDetailActivity.class);                    intent.putExtra(ItemDetailFragment.ARG_ITEM_ID, "");                    context.startActivity(intent);                }            }        };        SimpleItemRecyclerViewAdapter(ItemListActivity parent,                                      List<DocumentInfo> items,                                      boolean twoPane) {            mValues = items;            mParentActivity = parent;            mTwoPane = twoPane;        }        @Override        public ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {            View view = LayoutInflater.from(parent.getContext())                    .inflate(R.layout.item_document_list, parent, false);            return new ViewHolder(view);        }        @Override        public void onBindViewHolder(final ViewHolder holder, int position) {          //  holder.mIdView.setText(mValues.get(position).getdocumentId());            holder.mContentView.setText(mValues.get(position).getTitle());            holder.itemView.setTag(mValues.get(position));            holder.itemView.setOnClickListener(mOnClickListener);        }        @Override        public int getItemCount() {            return mValues.size();        }        class ViewHolder extends RecyclerView.ViewHolder {            final TextView mIdView;            final TextView mContentView;            ViewHolder(View view) {                super(view);                mIdView = (TextView) view.findViewById(R.id.id_text);                mContentView = (TextView) view.findViewById(R.id.content);            }        }    }    /**     * Alert dialog for Document name value     */    public void newDocumentLayout() throws JSONException {        AlertDialog.Builder builder = new AlertDialog.Builder(this);        // Get the layout inflater        LayoutInflater inflater = this.getLayoutInflater();        View view = inflater.inflate(R.layout.seteffi, null);        builder.setView(view);        // Add action buttons        // enter effi index value ...        final EditText docName = view.findViewById(R.id.docuName);        builder                .setPositiveButton("Valider", new DialogInterface.OnClickListener() {                    @Override                    public void onClick(DialogInterface dialog, int id) {                        final String name = docName.getText().toString();                        // data size for set id of new insertion                        Log.d("data size", String.valueOf(DataManager.getInstance().getdocuments().size()));                        String idDocument = "document" + String.valueOf(DataManager.getInstance().getdocuments().size());                        createNewNote(idDocument, name.toUpperCase());                        //mDocumentRecyclerAdapter.notifyDataSetChanged();                        recyclerView = findViewById(R.id.item_list);                        assert recyclerView != null;                        if (mTwoPane)                            initializeSimpleDisplayContent((RecyclerView) recyclerView);                        else                            initializeDisplayContent((RecyclerView) recyclerView);                        Snackbar.make(getCurrentFocus(), "DOCUMENT AJOUTER", Snackbar.LENGTH_SHORT).show();                    }                })                .setNegativeButton("Annuler", new DialogInterface.OnClickListener() {                    public void onClick(DialogInterface dialog, int id) {                    }                });        builder.create();        builder.show();    }    private void createNewNote(String docId, String title) {        // create content value        ContentValues values = new ContentValues();        values.put(DatabaseContract.DocumentInfoEntry.COLUMN_DOCUMENT_ID, docId);        values.put(DatabaseContract.DocumentInfoEntry.COLUMN_DOCUMENT_TITLE, title);        SQLiteDatabase db = mDbOpenHelper.getWritableDatabase();        long newRowId = db.insert(DatabaseContract.DocumentInfoEntry.TABLE_NAME, null, values);    }    /**     * save Image in sqlite     * @param name     * @param image     * @throws SQLiteException     */    public void addDrawView( String name, byte[] image) throws SQLiteException {        SQLiteDatabase database = mDbOpenHelper.getWritableDatabase();        ContentValues cv = new  ContentValues();        cv.put(DatabaseContract.DocumentInfoEntry.getKeyName(),    name);        cv.put(DatabaseContract.DocumentInfoEntry.getKeyImage(),   image);        database.insert( DatabaseContract.DocumentInfoEntry.getDbImageTable(), null, cv );    }    private void initializeSimpleDisplayContent(RecyclerView recyclerView) {        DataManager.loadFromDatabase(mDbOpenHelper);        List<DocumentInfo> documents = DataManager.getInstance().getdocuments();        recyclerView.setAdapter(new SimpleItemRecyclerViewAdapter(this, documents, mTwoPane));    }    private void initializeDisplayContent(RecyclerView recyclerView) {        DataManager.loadFromDatabase(mDbOpenHelper);        mRecyclerItems = recyclerView;        mNotesLayoutManager = new LinearLayoutManager(this);        mdocumentsLayoutManager = new GridLayoutManager(this,                getResources().getInteger(R.integer.document_grid_span));        //mNoteRecyclerAdapter = new NoteRecyclerAdapter(this, null);        List<DocumentInfo> documents = DataManager.getInstance().getdocuments();        mDocumentRecyclerAdapter = new DocumentRecyclerAdapter(this, documents);        displaydocuments();    }    private void displaydocuments() {        mRecyclerItems.setLayoutManager(mdocumentsLayoutManager);        mRecyclerItems.setAdapter(mDocumentRecyclerAdapter);    }}